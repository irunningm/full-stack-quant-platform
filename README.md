# 📈 AI 极速量化投研平台 (v1.0)

本项目是一个基于 `Python` + `Streamlit` 构建的极速本地量化环境，专为快速验证交易策略与交互式看盘设计。

## 🌟 核心特性
1. **秒级数据抓取**：A股对接 `AkShare`，美股对接 `yfinance`。
2. **极速本地缓存**：使用 `DuckDB` + `Parquet` 格式在本地做持久化缓存，二次读取百万行数据只需毫秒级。
3. **原生向量回测**：不使用慢速的 For 循环，全盘采用 `Pandas` 矩阵运算，瞬间输出策略胜率和净值曲线。
4. **专业图表**：使用 `lightweight-charts` 提供媲美 TradingView 的丝滑拖拽、缩放 K线交互体验。

---

## 🏗️ 系统架构解析

系统遵循 **单向数据流** 设计：`用户操作 -> 极速数据中间件 -> 策略计算引擎 -> 图表渲染`。

### 1. 前端交互层 (app.py)
* **侧边栏 (Sidebar)**：用户在这个控制中心选择市场 (A/美股)、输入代码、挑选日期范围。
* **策略炼丹炉**：动态切换策略（如双均线、MACD+RSI），并通过滑块（Sliders）动态调整各项技术指标参数。
* **图表视图 (View)**：主图渲染带买卖信号的 K 线，副图渲染 MACD/RSI 辅助震荡指标。
* **回测展板**：输出策略胜率、跑赢基准的回报率等硬核财务指标。

### 2. 策略引擎层 (Pandas Native)
当接管到历史数据后，引擎在极短的时间内完成以下运算：
1. **指标生成**：使用 `.rolling().mean()` 算出均线，或 `.ewm()` 算出 MACD/RSI 曲线。
2. **信号发生器**：通过判断金叉 (`>` 与 `<` 的前置状态反转) 生成 `Signal=1(持仓)` 或 `Signal=0(空仓)`。
3. **净值连乘计算**：使用 `(1 + Return).cumprod()` 基于历史每天的涨跌幅连乘，算出“初始 1 元钱”跑完整个区间的最终资金净值。

### 3. 数据层 (utils/data_loader.py + DuckDB)
数据层具有“带脑子”的请求阻滞机制：
* **命中缓存**：只要询问的时间段在本地 `data/` 目录下的 `.parquet` 文件中存在，**绝不发起网络请求**，直接通过 DuckDB 的 SQL 极速载入内存。
* **未命中缓存**：向互联网 API 抓取数据，清洗表头、统一中文字段后，追加落盘保存为 Parquet，供下次光速调用。

---

## 🌊 数据流转全景 (Data Flow)

这是一个标准的“从用户点击，到图表出金叉红箭头”的极速链路：

| 步骤 | 动作执行者 | 处理动作与逻辑 | 耗时级别 |
| :--- | :--- | :--- | :--- |
| **步骤 1** | 🧑‍💻 用户 | 在 Web 页面点击【开始投研分析】按钮 | 手动 |
| **步骤 2** | 📥 后端系统 | 携带股票代码和日期请求 `data_loader` 获取底层 K 线切片。 | `< 1ms` |
| **步骤 3** | 🗄️ 数据源 (DuckDB) | 判断本地是否有 Parquet 缓存。有缓存则瞬间返回；无缓存则掉起爬虫引擎下载，成功后转化为统一数据格式返回。 | `几毫秒` (若走网络需要几秒) |
| **步骤 4** | 🧮 策略引擎 (Pandas) | 数据灌入“炼丹炉”。执行矩阵运算：如 RSI 到底背离，叠加 MACD 指标触发了金叉，标记 `Signal=1`。 | `< 50ms` |
| **步骤 5** | 📊 财务回测模块 | 根据拿到的 Signal 跑单，计算出这次测试的总盈亏与胜率，计算双方随时间的推移资金对战图。 | `< 10ms` |
| **步骤 6** | 🖥️ Streamlit 渲染器 | 利用 `lightweight-charts` 将走势连线，根据金叉死叉日期在图表渲染红绿箭头。 | `< 100ms` |
| **步骤 7** | 🧑‍💻 用户 | 页面刷新完成！看到最新的资金结果。如果不满意，拖动滑块，**无缝回到步骤 4 (由于有本地缓存，彻底告别步骤 3 的等待网络抓取)**。 | 随时交互 |

---

> _"在量化的世界里，能让你随时无延迟验证猜想的环境，比一套高深的祖传代码更有价值。"_
